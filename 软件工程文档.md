# 软件工程文档

## 一、需求分析

### 系统模型图：

![系统模型](图片\系统模型.jpg)

### 数据流图：

![数据流图](图片\方案一数据流图.jpg)

### 数据字典：

```python
名字：棋盘地图
别名：map
描述：一个储存4*4的棋盘所有元素的二维数组
定义：棋盘地图=int类型的 4*4的 二维数组
位置：棋盘数据
	页面数据
```

```python
名字：当前得分
别名：point
描述：棋盘地图中最大的数据表示用户当前的得分
定义：当前得分=2{int类型}2048
位置：棋盘数据
	页面数据
```

```python
名字：游戏结束
别名：gameover
描述：判断游戏是否处于最高分结束状态（1），还是无法继续进行下去的结束状态（2），还是用户提前结束（3），或是还未结束（0）
定义：游戏结束=0{int类型}3
位置：重启数据
    结束数据
```

```python
名字：用户id
别名：_openid（user_id）
描述：在云数据库中唯一标识一个用户的id，通过云函数来访问，并且只在程序启动的时候访问一次
定义：用户id=数字或字母组成的字符串
位置：用户云数据
```

```python
名字：最高分
别名：best_point
描述：在云数据库中储存的该用户的最高得分
定义：最高分=0{int类型}2048
位置：用户云数据
```

```python
名字：用户操作
别名：operation
描述：用户的游戏操作，上滑（1）,下滑（2），左滑（3），右滑（4），非法操作（0）
定义：用户操作=0{int类型}4
位置：
```

### 数据模型（ER图）：

![](图片\ER图.jpg)

### 状态转换图：

![](图片\状态转换图.jpg)



## 二、概要设计

### 低成本的解决方案

#### 简要描述

只进行单纯的 2048 游戏过程，不保存用户的历史纪录，不需要使用云数据库的功能。

#### 系统模型图：

![系统模型](图片\系统模型.jpg)

#### 数据流图：

![数据流图](图片\数据流图.jpg)

### 高成本的“十全十美”的系统

#### 简要描述

不但能进行 2048 游戏的正常功能，还支持用户的数据保存，每当用户登录到游戏中时，能实时看到自己的历史最高成绩。并且在游戏结束后系统自动保存最高历史记录。需要使用到云数据库功能。

#### 系统模型图：

![系统模型](图片\系统模型.jpg)

#### 数据流图：

![数据流图](图片\方案一数据流图.jpg)



## 三、详细设计

### 层次方框图：

![](图片\层次方框图.png)

### IPO图：

```python
IPO表
系统：开始界面
模块：（获取云数据库）cloud_database
编号：P1
作者：谢凡
时间：2022/5/

被调用：开始界面的页面初始化
调用：无
输入：无
输出：user_id
	best_point
处理：
局部数据元素：

注释：通过云函数获取user_id，然后更具user_id去云数据库中获取其对应的best_point，并且将这两个数据存储到程序的全局变量中，便于其他函数调用。
```

```python
IPO表
系统：开始界面
模块：（开始游戏）start
编号：P6
作者：徐松煜
时间：2022/4

被调用：点击开始游戏按钮
调用：重启操作 P2
输入：无
输出：无
处理：
局部数据元素：

注释：当用户点击了“开始按钮”后跳转到游戏界面，并且调用重启操作P2来初始化棋盘。
```

```python
IPO表
系统：游戏界面
模块：（重启操作）restart
编号：P2
作者：田洋
时间：2022/6/1

被调用：开始游戏 P6
	结束操作 P5
调用：无
输入：无
输出：无
处理：
局部数据元素：map
	point

注释：初始化棋盘map，随机生成两个数字（位置不重复的2，其他为0），point赋值为2
```

```python
IPO表
系统：游戏界面
模块：（获取用户操作）get_operation
编号：P7
作者：田洋
时间：2022/6/1

被调用：在游戏区域获取到用户操作时
调用：游戏操作 P3
输入：无
输出：无
处理：
局部数据元素：operation

注释：在棋盘中通过bindtouchstart、move、end的方式来计算用户在棋盘中的操作，然后将操作的编号（0-4）作为输出，来调用游戏操作P3模块。
```

```python
IPO表
系统：游戏界面
模块：（游戏操作）operation
编号：P3
作者：田洋
时间：2022/6/1

被调用：获取用户操作 P7
调用：结束操作P4
输入：operation
输出：无
处理：
局部数据元素：map
	point

注释：通过输入的operation来更新map（包括添加一个新的2），并且计算出map当前的得分point，然后判断map是否已经是结束状态（不能移动或已经达到2048）
```

```python
IPO表
系统：结束提示
模块：（结束操作）over
编号：P4
作者：梁文韬
时间：2022/6/10

被调用：用户按下“重新启动”
	游戏操作P3
调用：更新云数据库P5
	重启界面P2
输入：point
输出：无
处理：
局部数据元素：

注释：通过全局变量获取到best_point，跳出一个结束提示，如果point>best_point的话还需要调用更新云数据库P5，并且将全局变量best_point更新，最后当用户点击“关闭按钮”之后调用重启操作P2把棋盘更新。
```

```python
IPO表
系统：结束提示
模块：（更新云数据库）update_database
编号：P5
作者：谢凡
时间：2022/5

被调用：结束操作P4
调用：无
输入：best_point
输出：无
处理：
局部数据元素：
	user_id

注释：通过全局变量user_id去云数据库中定位需要修改的数据。
```

### 程序流程图

![cloud_database](图片\程序流程图\cloud_database.JPG)

![get_operation](图片\程序流程图\get_operation.JPG)

![operation](图片\程序流程图\operation.JPG)

![restart](图片\程序流程图\restart.JPG)

![update_database](图片\程序流程图\update_database.JPG)